完善之前由 Spring 和 Spring MVC 完成的 CRM 项目: 添加完整的权限管理功能
2017.01.02
1. 底层数据访问由 JdbcTemplate 改为 Hibernate
2. 使用 hibernate 重写 po 类
    2.1 角色与用户之间是多对多关系
        维护关系: 由用户 User 维护
    2.2 角色与资源之间是多对多关系
        维护关系; 由角色 Role 维护
    2.3 资源表中 parent 自关联
2017.01.03
3. 完成登陆页面和登陆逻辑
    3.1 使用过滤器检查是否登陆
    3.2 增加安全退出功能
4. 数据库改为 MySql, 方便部署项目
5. 为用户分配角色
    5.1 同步到数据库中的 crm_user_role 表
    5.2 新页面上进行角色分配
6. 为角色分配资源
    6.1 使用模态框结合 ztree 插件进行资源分配
    6.2 数据可以同步到 crm_role_resource 表
7. 检查用户操作: 控制权限
    7.1 需要控制权限的方法上加上自定义注解
    7.2 拦截器中检查当前角色是否有访问该方法的权限
        7.2.1 从数据库中查询出当前登陆用户所有角色, 以及各个角色的所有权限列表
        7.2.2 获取当前访问访问方法上的权限注解
        7.2.3 从列表中查询, 如果有则放行, 否则就抛出异常
    7.3 获取抛出的权限访问异常, 然后返回到指定的权限异常处理页面
    注意: 管理权限如 SYS_MANAGE 对应菜单, 而功能权限如 SYS_USER_VIEW 对应方法; 而功能权限属于管理权限的子权限, 有子权限一定有
    父权限, 但是反过来不一定.
8. 当删除角色时, 如果有用户依赖于该角色, 直接删除角色会出错, 需要先断开联系;
    8.1 删除角色同样有该问题存在
    8.2 删除方法需要重写 hashcode() 和 equals() 方法
9. 修改项目使其与文档匹配
10. 增加部门管理
11. 增加部门表, Dept 类
    11.1 部门与用户之间是一对多的关系, 部门为一, 用户为多
    11.2 由用户维护关系

12. 动态生成菜单
    12.1 根据当前用户的资源列表, 显示其应该显示的菜单


其他: 可选
1. 菜单页面, 点击菜单管理后, 打开菜单列表

2. 忘记密码, 通过邮件找回


细节部分:
1. 优化命名

bug:
1. 当前用户将自己从用户表中删除, 会报错;
    控制权限, 只有管理员才有删除用户权限; 且只有管理员才能控制权限
    管理员删除自己?
    删除用户的方法中进行判断, 当前删除用户是否和当前登陆用户 id 相同, 相同则不允许操作;
2. 更新时, 已有内容如果没有设置新内容, 会被擦除掉
    当修改维护主键的对象时, 其中保存其他保存其他对象的集合会被清空, 如修改用户, 传入到服务器的 user 对象中 roles 集合为 null
    将会把 crm_user_role 中的对应记录删除掉, 关系断开, 当前用户失去所有角色
    解决: 在传入到 service 层之前, 查出原来的对象, 并为传过来的对象设置集合属性
    问题: 修改角色时, 用户会同步更新, 但是角色原先分配的资源被清空
    更新: 应该是正常现象, 如果没有设置新集合, 更新时就会清空原来的对象的集合
    如果想要保留之前的角色或资源怎么做? 先查出来, 然后为当前对象设置集合, 然后调用 merge() 方法更新而不是 update() 方法, 因为查询
    操作会在当前 session 中缓存一个对象, 如果再调用 update() 方法将会导致重复

当前用户进行修改属于自己的用户信息, 角色或是资源时会出现以下问题:
3. 因为当前 session 中已经保存有当前登陆用户对象, 所以再次修改当前用户时, 会报错: 当前 session 中已经存在同 id 的对象, 导致无法修改; 修改角色同样出错
4. 无法修改属于自己的资源, 不属于自己的资源可以修改, 当前 session 中已经存在同 id 对象; 关闭拦截器后, 即可正常修改
    有可能是因为拦截器中已经获取过资源对象

    解决 3 和 4: 将 update() 方法修改为 merge() 方法即可

5. 用户一旦修改自己的用户, 将立即失去角色, 导致后续操作显示无权限;
    同样, 如果一旦修改自己唯一的角色信息, 那么也会立即失去所有资源, 后续操作显示无权限
    解决: 同2
